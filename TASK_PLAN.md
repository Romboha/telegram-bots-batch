# План завдань і розвитку проекту Telegram ботів

Цей документ описує план розвитку проекту системи Telegram ботів, що взаємодіють з n8n.

## Основні задачі

### Фаза 1: Базова функціональність ✅

- [x] Створення системи запуску кількох ботів Telegram
- [x] Інтеграція з n8n через вебхуки
- [x] Розпізнавання імен ботів у повідомленнях
- [x] Підтримка різних варіантів імен ботів
- [x] Обробка цитованих повідомлень
- [x] Випадкові відповіді на повідомлення без згадки ботів

### Фаза 2: Розширена функціональність

- [ ] Додати обробку мультимедійних повідомлень (фото, документи)
- [ ] Покращити алгоритм розпізнавання імен ботів
- [ ] Реалізувати механізм "пам'яті" для збереження контексту розмови
- [ ] Створити панель адміністратора для моніторингу ботів
- [ ] Додати можливість керування ботами через команди в Telegram

### Фаза 3: Інтеграція та масштабування

- [ ] Підтримка додаткових платформ обміну повідомленнями (Discord, Slack)
- [ ] Розширені API для взаємодії з зовнішніми сервісами
- [ ] Система моніторингу та логування активності ботів
- [ ] Підтримка кластеризації для горизонтального масштабування
- [ ] Аналітика використання ботів

## Архітектура проекту

```
telegram-bots-batch/
│
├── api/                  # API інтеграції
│   └── n8n-api.js        # Модуль для взаємодії з n8n
│
├── bots_configs/         # Конфігурації ботів
│   └── example_bot.js    # Приклад конфігурації бота
│
├── data/                 # Каталог для даних ботів
│   └── example-bot-temp-files/ # Тимчасові файли бота
│
├── handlers/             # Обробники подій
│   ├── bot-handlers.js   # Обробники повідомлень
│   └── bot-lifecycle.js  # Управління життєвим циклом ботів
│
├── utils/                # Утиліти
│   ├── bot-name-detector.js   # Визначення імен ботів
│   ├── message-analyzer.js    # Аналіз повідомлень
│   ├── multi-bot-detector.js  # Визначення кількох ботів
│   └── quotes-handler.js      # Обробка цитат
│
├── workflows/            # Воркфлоу для n8n
│   └── RAG_AI_Agent_Workflow.json # Воркфлоу AI агента з RAG
│
├── .env.example          # Приклад файлу змінних середовища
├── .gitignore            # Ігноровані файли для Git
├── bot-dispatcher.js     # Диспетчер ботів
├── global-config.js      # Глобальні налаштування
├── index.js              # Головний файл програми
├── package.json          # Метадані проекту та залежності
├── README.md             # Документація проекту
├── start-bots.sh         # Скрипт для запуску ботів
└── TASK_PLAN.md          # План розвитку проекту
```

## Принципи роботи ботів

1. **Пріоритизація відповідей:**
   - Якщо згадується один бот у тексті — відповідає він
   - Якщо згадується кілька ботів — відповідає перший згаданий з можливістю відповіді від другого
   - Якщо це відповідь на повідомлення бота — відповідає цей бот
   - Якщо не згадується жоден бот — випадкова відповідь від випадкового бота з малою вірогідністю

2. **Розпізнавання імен ботів:**
   - Пряма згадка через @username
   - Точний збіг з варіантами імен
   - Часткове входження імені (для достатньо довгих імен)
   - Врахування регістру і розділових знаків

3. **Обробка повідомлень:**
   - Текстові повідомлення обробляються через n8n
   - Файлові повідомлення (заплановано для майбутніх версій)
   - Цитовані повідомлення враховуються для визначення контексту

## Інтеграція з n8n

1. **Відправка даних до n8n:**
   - Використання вебхуків для відправки даних
   - Підтримка тестового та продакшн вебхуків
   - Передача контексту повідомлення (хто написав, що написав, кому відповів)

2. **Отримання відповідей від n8n:**
   - Обробка JSON-відповідей
   - Підтримка форматованого тексту
   - Обробка помилок та повторна відправка запитів

3. **Використання готових воркфлоу:**
   - RAG AI Agent воркфлоу (workflows/RAG_AI_Agent_Workflow.json)
   - Система використовує механізм Retrieval-Augmented Generation для обробки запитів
   - Доступ до бази знань та історії чатів
   - Просте налаштування через імпорт готового воркфлоу
   - **Для роботи обов'язково потрібно підключити зовнішню або локальну модель ШІ** (OpenAI, Anthropic Claude, Ollama, LLaMA тощо)

## Подальший розвиток

Основні напрями роботи на найближчий час:
- Покращення обробки файлових повідомлень
- Додаткові алгоритми для аналізу контексту повідомлень
- Розширення API для інтеграції з іншими сервісами
- Створення веб-інтерфейсу для моніторингу та управління ботами
